

<br />
<br />
<br />
<div  class="container-fluid" id="vue1">
    <div class="row">


        <div class="col-sm-12">
<ul class="breadcrumb">
  <li><a href="edit-basics">Basics</a></li>
  <li><a href="edit-story">Story</a></li>
  <li><a href="edit-perks">Perks</a></li>
  <li><a href="edit-about">About you</a></li>
  <li><a href="edit-accounts">Account</a></li>
</ul>

          </div>

        
        <div class="col-sm-8">
<h1>Let’s get started.</h1>
<p>Make a great first impression with your campaign title and image, and set your funding goal, campaign duration, and project category.</p>

<!-- <form enctype="multipart/form-data" method="POST" action="/create_crowdsale"> -->
  <div class="form-group light-blue" >
    <label for="exampleInputEmail1">Project image</label>
        <p class="form-text text-muted">
      This is the first thing that people will see when they come across your project. Choose an image that’s crisp and text-free. Here are some tips.
                                    <p class="form-control-static">
                                        <div style="border: 1px dashed #000; background: #fff; width: 100%; display: block; padding: 20px;" class="text-center">
                                            <p class="text-center">
                                              <strong>Choose an image from your computer</strong>
                                            </p>
                                                </p>
                                                <p class="text-center">
                                                  <input onchange="readURL(this)" multiple="multiple" id="photo_file_btn" type="file">
                                                  <br>
                                                  <!-- <input onchange="uploadPhotos()" id="photo_file_btn" type="file">
                                                  <br> -->
                                                </p>
                                            <p>This is the main image associated with your project. Make it count!</p>    
                                            <p>At least <strong>1024x576 pixels</strong> • 16:9 aspect ratio</p>    
                                        </div>
                                    </p>
                                    <p class="form-text text-muted">
                                        JPEG, PNG, GIF, or BMP • 50MB file limit
                                    </p>
                                                    <div class="progress">
                                                      <div class="progress-bar" role="progressbar"></div>
                                                    </div>

  </div>
  <div class="form-group light-blue">
    <label for="crowdsale_title">Project title</label>
    <input type="text" class="form-control form-control-lg" id="crowdsale_title" v-model="crowdsale.title" aria-describedby="emailHelp" placeholder="Enter email" name="crowdsale_title">
<p class="form-text text-muted">
  Our search looks through words from your project title and blurb, so make them clear and descriptive of what you’re making. Your profile name will be searchable, too.<br />

These words will help people find your project, so choose them wisely! Your name will be searchable too.
</p>  
    </div>
  <div class="form-group light-blue">
    <label for="exampleInputEmail1">Short blurb</label>
    <textarea v-model="crowdsale.description" class="form-control form-control-lg" rows="3"></textarea>
<p class="form-text text-muted">
  Legal description of the property.


</p>  
    </div>
  <div class="form-group light-blue">
    <label for="style">Style</label>
    <div class="row">
      <div class="col-6">
        <select value="<%= crowdsale.style %>" class="form-control custom-select">
              <% for(style in styles ) { %>
                <option value="<%= styles[style]%>">
                  <%= styles[style] %>
                </option>
                <% } %>
        </select>
      </div>
      <div class="col-6">
        <select class="form-control custom-select">
          <option value="1">Subcategory (optional)</option>

        </select>
      </div>
    </div>
    </div>
  <div class="form-group light-blue">
    <label for="exampleInputEmail1">Project location</label>
     <div class="input-group  input-group-lg">
      <span class="input-group-btn">
        <button class="btn btn-secondary" type="button"><i class="fa fa-location-arrow" aria-hidden="true"></i></button>
      </span>
      <input type="text" class="form-control" placeholder="Search for...">
    </div>
  </div>
  <div class="form-group light-blue">
    <label for="exampleInputEmail1">Funding duration</label>
    <div class="input-group">
  <input type="text" class="form-control form-control-lg" placeholder="" aria-describedby="basic-addon2">
  <span class="input-group-addon" id="basic-addon2">number of days</span>
</div>
<p id="passwordHelpBlock" class="form-text text-muted">
  Up to 60 days, but we recommend 30 or fewer
</p>  
    </div>
  <div class="form-group light-blue">
    <label for="exampleInputEmail1">Funding goal</label>
    <div class="input-group  col-4 pl-0">
  <input type="text" class="form-control form-control-lg" placeholder="" value="0" aria-describedby="basic-addon2">
  <span class="input-group-addon" id="basic-addon2">GBP</span>
</div>
<p id="passwordHelpBlock" class="form-text text-muted">
  If your project is successfully funded, the following fees will be collected from your funding total:  5% fee and payment processing fees (between 3% and 5%). Please note we do not withhold VAT. If funding isn’t successful, there are no fees.
</p>  
    </div>
  <div class="form-group light-blue">
    <label for="exampleInputEmail1">Project collaborators</label>


    <div class="row mb-2">
      <div class="col-6">
        <input type="email" class="form-control form-control-lg" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Enter email">
      </div>
      <div class="col-6">

      </div>
    </div>


    <div class="row">
      <div class="col-6">
        <input type="email" class="form-control form-control-lg" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Enter email">
      </div>
      <div class="col-6">
        <p  class="form-control-static pt-3"><a href="#"><i class="fa fa-plus" aria-hidden="true"></i> Add collaborator</a></p>
      </div>
    </div>

    </div>

  </fieldset>
<!-- </form> -->
<br />
<br />
<br />
<h1>TEST</h1>
<img src="uploads/upload_17f6be87b5b38d230131fa1b4d9519fc" alt="">

                </div>


        <div class="col-sm-4">
        <div :class="fixed + ' row'">
        <div class="col-sm-10 offset-sm-2">


               <strong>Getting started?</strong>
               <p>Visit Campus to read discussions about preparing for a project and more.</p>
               <br />
               <strong>Preview</strong>
<hr />
                  <!-- <img id="blah" src="#" alt="your image" /> -->
                  <!-- <div id="vue1"> -->
                  <%- include partials/box_vue %>

                  <!-- </div> -->

				        <!-- {% for project in site.data.projects limit:1 %}
					          {% include box project=project %}
				        {% endfor %}  -->
          </div>
          </div>
          </div>


            </div>
            <br />
<br />
<br />
            </div>

<nav class="navbar fixed-bottom navbar-light bg-faded" style="background: #fff; border-top: 1px solid #eee">
          <div class="container">

    <!-- <a href="edit_crowdsale" class="btn btn-primary btn-lg float-right">Save campaign</a>
        <a href="edit_crowdsale" class="btn btn-link btn-lg float-right">Discard changes</a> -->
    <button class="btn btn-primary btn-lg float-right" onclick="save_crowdsale_update()">Save changes</button>
    <!-- <button class="btn btn-lg float-right">Discard changes</button> -->

  </div>
</nav>

<script>
  // function dataURItoBlob(dataURI) {
  //   // console.log(dataURI)
  //   console.log('dataURItoBlob')
  //   // dataURI = dataURI[0]
  //   // convert base64/URLEncoded data component to raw binary data held in a string
  //   var byteString;
  //   // console.log(dataURI)
  //   if (dataURI.split(',')[0].indexOf('base64') >= 0)
  //     byteString = atob(dataURI.split(',')[1]);
  //   else
  //     byteString = unescape(dataURI.split(',')[1]);

  //   // separate out the mime component
  //   var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];

  //   // write the bytes of the string to a typed array
  //   var ia = new Uint8Array(byteString.length);
  //   for (var i = 0; i < byteString.length; i++) {
  //     ia[i] = byteString.charCodeAt(i);
  //   }

  //   return new Blob([ia], { type: mimeString });
  // }

  // function save_crowdsale_update(){
  //   console.log('save_crowdsale_update')
  //   // var data = new FormData();
  //   // $('#photo_file_btn').files, function (i, file) {
  //   //   data.append('file-' + i, file);
  //   // };
  //   // console.log(data)
  //   // vue1.crowdsale.photos.forEach((photo, index)=>{
  //   //   console.log('looping through photos')
  //   //   var blob = dataURItoBlob(photo)
  //   //   // data.append(`photo${index}`, blob)
  //   // })
  //   var data = vue1.crowdsale
  //   delete data.photos
  //   // console.log('vue1.crowdsale')
  //   // console.log(vue1.crowdsale)
  //   // data.append('crowdsale', vue1.crowdsale)
  //   console.log('data')
  //   console.log(data)
  //   // data.get('crowdsale')
  // // data = 'data'
  //   // $.post('/save_crowdsale_update', {data}, (resp)=>{
  //   //   console.log(resp)
  //   // })   
  //   $.ajax({
  //     url:'/save_crowdsale_update',
  //     data: data,
  //     cache: false,
  //     contentType: false,
  //     processData: false,
  //     method: 'POST',
  //     success:(resp)=>{
  //       console.log('resp')
  //       console.log(resp)
  //     }
  //   })
  // }


  function readURL(input) {
    var formData = new FormData();
    if (input.files && input.files[0]) {
      console.log(input.files)
      Array.prototype.forEach.call(input.files, (file)=>{
          var reader = new FileReader();

          reader.onload = function (e) {
            const data = e.target.result
            // vue1.crowdsale.photos.push(data)
        }
        // add the files to formData object for the data payload
        formData.append('uploads[]', file, file.name);
        reader.readAsDataURL(file);

      })



      $.ajax({
        url: '/upload_crowdsale_photos',
        type: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        success: function (data) {
          console.log('upload successful!');
          console.log(data)
          vue1.crowdsale = data
        },
        error: function (data) {
          console.log('error ' + data)
          for (var k in data) {
            console.log(k + ' : ' + data[k])
          }
        },
        xhr: function () {
          // create an XMLHttpRequest
          var xhr = new XMLHttpRequest();

          // listen to the 'progress' event
          xhr.upload.addEventListener('progress', function (evt) {

            if (evt.lengthComputable) {
              // calculate the percentage of upload completed
              var percentComplete = evt.loaded / evt.total;
              percentComplete = parseInt(percentComplete * 100);

              // update the Bootstrap progress bar with the new percentage
              $('.progress-bar').text(percentComplete + '%');
              $('.progress-bar').width(percentComplete + '%');

              // once the upload reaches 100%, set the progress bar text to done
              if (percentComplete === 100) {
                $('.progress-bar').html('Done');
                // socket.emit('showMeTheFiles', localStorage.getItem("username"))
              }

            }

          }, false);

          return xhr;
        }
      });

    }
  }


  var current_eth_price = <%= current_eth_price %>
    var crowdsale = <%- JSON.stringify(crowdsale) %>
      console.log(crowdsale)

    var vue1 = new Vue({
      el: '#vue1',
      data: {
        crowdsale: {
          id:crowdsale._id,
          title:crowdsale.title,
          token:crowdsale.token,
          owner:crowdsale.owner,
          goal:crowdsale.goal,
          wallet:crowdsale.wallet,
          rate:crowdsale.rate,
          weiRaised:crowdsale.weiRaised,
          vault:crowdsale.vault,
          symbol:crowdsale.symbol,
          openingTime:crowdsale.openingTime,
          closingTime:crowdsale.closingTime,
          name:crowdsale.name,
          goal_reached:crowdsale.goal_reachedn,
          is_canceled:crowdsale.is_canceled,
          hasClosed:crowdsale.hasClosed,
          isFinalized:crowdsale.isFinalized,
          check_finalization_time_limit_done:crowdsale.check_finalization_time_limit_done,
          transaction:crowdsale.transaction,
          photos:crowdsale.photos,
          address_line1:crowdsale.address_line1,
          address_line2:crowdsale.address_line2,
          city:crowdsale.city,
          region:crowdsale.region,
          postal_code:crowdsale.postal_code,
          country:crowdsale.country,
          user_id:crowdsale.user_id,
          tax_id:crowdsale.tax_id,
          description:crowdsale.description,
          home_style:crowdsale.home_style,
          amount_money_needed:crowdsale.amount_money_needed,
          amount_down_payment:crowdsale.amount_down_payment,
          is_approved:crowdsale.is_approved,
          is_deployed:crowdsale.is_deployed,
          time_user_created:crowdsale.time_user_created,
          last_updated:crowdsale.last_updated
        },
      window_width: window.innerWidth,
      current_eth_price: current_eth_price

      }, 

      computed:{
        photo_count:function (){
          return this.crowdsale.photos.length
        },
        fixed:function(){
          return this.window_width > 580 ? 'fixed_card ' : ' no'
        }
      },
      methods:{
        handleResize:function(event){
          this.window_width = window.innerWidth
          // console.log(window.innerWidth)
        }
      },
      mounted: function () {
        window.addEventListener('resize', this.handleResize)
      },
      beforeDestroy: function () {
        window.removeEventListener('resize', this.handleResize)
      }
    })




    // window.uploadPhotos = function () {
    //     // Read in file
    //     var file = event.target.files[0];
    //   //   if (event.target.files && event.target.files[0]) {
    //   //   var reader = new FileReader();

    //   //   reader.onload = function (e) {
    //   //     const data = e.target.result
    //   //     vue1.crowdsale.photos.push(data)
    //   //   }

    //   //   reader.readAsDataURL(event.target.files[0]);
    //   // }

    //     // Ensure it's an image
    //     if (file.type.match(/image.*/)) {
    //       console.log('An image has been loaded');

    //       // Load the image
    //       var reader = new FileReader();
    //       reader.onload = function (readerEvent) {
    //         var image = new Image();
    //         image.onload = function (imageEvent) {

    //           // Resize the image
    //           var canvas = document.createElement('canvas'),
    //             max_size = 554,// TODO : pull max size from a site config
    //             width = image.width,
    //             height = image.height;
    //           if (width > height) {
    //             if (width > max_size) {
    //               height *= max_size / width;
    //               width = max_size;
    //             }
    //           } else {
    //             if (height > max_size) {
    //               width *= max_size / height;
    //               height = max_size;
    //             }
    //           }
    //           canvas.width = width;
    //           canvas.height = height;
    //           canvas.getContext('2d').drawImage(image, 0, 0, width, height);
    //           var dataUrl = canvas.toDataURL('image/jpeg');
    //           // var resizedImage = dataURItoBlob(dataUrl);
    //           // $.event.trigger({
    //           //   type: "imageResized",
    //           //   blob: resizedImage,
    //           //   url: dataUrl
    //           // });
    //           vue1.crowdsale.photos.push(dataUrl)
    //         }
    //         image.src = readerEvent.target.result;
    //       }
    //       reader.readAsDataURL(file);
    //     }
    //   };
</script>